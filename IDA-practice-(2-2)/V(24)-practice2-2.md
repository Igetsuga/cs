# Сиразетдинов Рустем КМБО-01-21 Вариант 24
## Практическая работа № 2-2
___
Набор данных: `attitude`;
Регрессоры: `raises`, `critical`, `advance`
___
### Вступление

В [практической работе № 2](https://gist.github.com/Igetsuga/7edc63f6034f5f181213469da3597a8a) были получены две наиболее хорошие модели:

- `model_1` = `no_critical_model_log_2` = `lm(rating ~ I(log(raises)) + I(log(advance)), data)`

которая выдвала следующую зависимость:
$$rating = (-115.572) + 5.55.004 * I(log(raises)) + (-12.963) * I(log(advance))$$

с показателями: **Multiple R-squared**:  0.4074,	 **Adjusted R-squared**:  0.3635, **p-value**: 0.0008557

и модель 
- `model_2` = `no_critical_model_mult_1` = `lm(rating ~ I(raises^2) + advance, data)`

из которой мы получили, что 
$$rating = 51.307766 + 0.006657 * I(raises^2) + (-0.353557) * advance$$

показатели которой: **Multiple R-squared**:  0.4069,	 **Adjusted R-squared**:  0.363,  **p-value**: 0.0008645

обе эти модели имеют практически идентичные показатели, являясь при этом довольно плохими моделями, поэтому не важно какую из этих моделей мы выберем для дальнейших действий. Для определенности выберем модель `model_1`.


___
### Построение доверительных интервалов для всех коэффициентов модели
___

`model_1` = `lm(rating ~ I(log(raises)) + I(log(advance)), data)`

Для построения доверительного интервала необходимо знать значение коэффициента, полученного из построенной модели, $\sigma$- стандартная ошибка (СКО коэффициента), полученную из построенной модели, и значение `t-критерия Стьедента`, которое может быть вычислено с помощью функций языка R.

- Количество наблюдений- 30

- Количество исследуемых коэффициентов- 3

- Количество степеней свободы-  $30 - 3 = 27$
- ```R
    t_value = qt(0.975, df = 27)
    t_value
  ```
**Итог**: $t(value) = 2.051831$

Доверительный интервал имеет вид: $[\beta - t*\sigma , \beta + t*\sigma]$ .

1) Расчитаем доверительный интервал для коэффициента `Intercept`.

    ```R
                    Estimate   Std. Error t value Pr(>|t|)    
    (Intercept)     -115.572     46.471   -2.487  0.019361 *  
    ```

    - значение коэффициента: `(-115.572)`
    - стандартная ошибка: `46.471`
    - t-критерий Стьедента: `2.051831`
    
    Доверительный интервал: $[-115.572 - 2.051831*46.471 , -115.572 + 2.051831*46.471]$
    т.е. $[-210.9226 , -20.22136]$

    **Итог**: С вероятностью $\frac{19}{20}$ значение коэффициента `Intercept` будет лежать в интервале $[-210.9226 , -20.22136]$. Отвергаем гипотезу $\beta = 0$, т.е. с вероятностью $\frac{1}{20}$ коэффициент `Intercept` может принимать значение 0, что говорит о том, что это получено хорошее значение коэффициента.     

2) Расчитаем доверительный интервал для коэффициента `I(log(raises))`.

    ```R
                    Estimate   Std. Error t value Pr(>|t|)    
    I(log(raises))    55.004     13.119   4.193   0.000265 ***  
    ```

    - значение коэффициента: `55.004`
    - стандартная ошибка: `13.119`
    - t-критерий Стьедента: `2.051831`
      
    
    Доверительный интервал: $[55.004 - 2.051831*13.119 , 55.004 + 2.051831*13.119]$
    т.е. $[28.08603 , 81.92197]$

    **Итог**: С вероятностью $\frac{19}{20}$ значение регрессора `I(log(raises))` будет лежать в интервале $[28.08603 , 81.92197]$. Отвергаем гипотезу $\beta = 0$, т.е. с вероятностью $\frac{1}{20}$ регрессор `I(log(raises))` может принимать значение 0, что еще раз говорит о том, что это хороший регрессор.

3) Расчитаем доверительный интервал для коэффициента `I(log(advance))`.

    ```R
                    Estimate   Std. Error t value Pr(>|t|)    
    I(log(raises))  -12.963      9.264    -1.399  0.173132
    ```

    - значение коэффициента: `-12.963`
    - стандартная ошибка: `9.264`
    - t-критерий Стьедента: `2.051831`
      
    
    Доверительный интервал: $-12.963 - 2.051831*9.264 , -12.963 + 2.051831*9.264]$
    т.е. $[-31.97116 , 6.045162]$

    **Итог**: С вероятностью $\frac{19}{20}$ значение регрессора `I(log(advance))` будет лежать в интервале $[-31.97116 , 6.045162]$. Принимаем гипотезу $\beta = 0$, т.е. с вероятностью $\frac{1}{20}$ регрессор `I(log(advance))` может принимать значение 0, что еще раз говорит о том, что это плохой регрессор.

**Итог**: 

|             Регрессор | Оценка коэффициента $\beta$ | Std. Error |  Доверительный интервал | $\beta = 0$ гипотеза |
|----------------------:|:-------------------:|:----------:|:-----------------------:|:---------:|
| Свободный коэффициент |       -115.572      |   46.471   | [-210.9226 , -20.22136] | Отвергаем |
| I(log(raises))        |        55.004       |   13.119   |  [28.08603 , 81.92197]  | Отвергаем |
| I(log(advance))       |       -12.963       |    9.264   |  [-31.97116 , 6.045162] | Принимаем |


___
### Вывод об отвержении или невозможности отвергнуть статистическую гипотезу о том, что коэффициент равен 0.
___
После дополнительного изучения построенной модели `model_1` мы получили значения доверительных интервалов всех коэффициентов перед регрессорами в модели.

1) Посмотрим на доверительный интервал `Свободного коэффициента`.
    $$[-210.9226 , -20.22136]$$

    Поскольку $0 \notin [-210.9226 , -20.22136]$, то мы отвергает гипотезу о том, что значение этого коэффициента может равняться нулю. Значит этот коэффициент правильно описывает модель. 

2) Посмотрим на доверительный интервал `I(log(raises))`.
    $$[28.08603 , 81.92197]$$

    Поскольку $0 \notin [28.08603 , 81.92197]$, то мы отвергает гипотезу о том, что значение этого коэффициента может равняться нулю. Значит переменная `rating` зависит от этого регрессора, хотя границы доверительного интервала и значение Std. Error равное 13.119 слишком большие, чтобы говорить о сильной зависимости между ними.

3) Посмотрим на доверительный интервал `I(log(advance))`.
    $$[-31.97116 , 6.045162]$$

    Поскольку $0 \in [-31.97116 , 6.045162]$, то мы принимаем гипотезу о том, что значение этого коэффициента может равняться нулю. Значит переменная `rating` не зависит от этого регрессора, поэтому лучше исключить его из модели.
___
### Построение доверительного интервала для одного прогноза (p  = 95%).
___

Для построения доверительного интервала необходимо знать:

- ошибка $\sigma$ по всей модели
- прогноз модели
- доверитильный интервал

Но мы можем сразу построить доверительный интервал для прогноза модели при конкретных значениях регрессоров, не находя каждый из пунктов выше по отдельности.

```R
new.data = data.frame(raises = 34, advance = 51

predict(model_1, new.data, interval = "confidence")
```

т.е. для регрессоров: 
| Регрессор | raises | advance |
|-----------|-------:|--------:|
| Значение  |     34 |      51 |

мы получили следующие значения прогноза модели и доверительного интервала:

|   |      fit |      lwr | upr      |
|---|---------:|---------:|----------|
| 1 | 27.42529 | 7.856132 | 46.99445 |

С вероятностью $p  = 95\%$ значение модели на значениях данных регрессоров будет равняться $27.42529$.

___
### Полный код программы.

```R

library("lmtest")
library("GGally")
library("car")

data = na.omit(attitude) # insertion database exclude NA answers
      # rating- объясняемая переменная
      # {raises, critical, advance}- регрессоры

help(attitude)

model_1 = lm(rating ~ I(log(raises)) + I(log(advance)), data)
summary(model_1)

t_value = qt(0.975, df = 27)
t_value


new.data = data.frame(raises = 34, advance = 51)

predict(model_1, new.data, interval = "confidence")

```
___